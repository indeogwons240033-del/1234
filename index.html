<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>정규분포 Z 확률 계산기</title>
  <style>
    :root{--bg:#f6f8fb;--card:#ffffff;--accent:#2563eb;--muted:#64748b}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,'Noto Sans',Arial}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#ffffff);color:#0f1724}
    .wrap{max-width:900px;margin:36px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    h1{font-size:20px;margin:0;color:var(--accent)}
    .controls{display:flex;gap:10px;align-items:center}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(15,23,36,0.06)}
    label{font-size:13px;color:var(--muted);display:flex;flex-direction:column}
    input[type=number]{width:110px;padding:8px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);font-size:14px}
    button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(37,99,235,0.12)}
    canvas{width:100%;height:420px;border-radius:10px;background:linear-gradient(180deg,#ffffff,#fbfdff)}
    .info{margin-top:12px;display:flex;gap:12px;align-items:center}
    .pill{background:rgba(37,99,235,0.08);color:var(--accent);padding:8px 12px;border-radius:999px;font-weight:600}
    .small{color:var(--muted);font-size:13px}
    footer{margin-top:16px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>정규분포 Z 확률 계산기</h1>
      <div class="small">곡선을 클릭해 구간을 선택하세요. 선택 영역이 자동으로 음영 처리됩니다.</div>
    </header>

    <div class="card">
      <div style="display:flex;gap:18px;align-items:center;justify-content:space-between;flex-wrap:wrap">
        <div class="controls">
          <label>Z 최소<input id="zMin" type="number" step="0.01" value="-1"></label>
          <label>Z 최대<input id="zMax" type="number" step="0.01" value="1"></label>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="compute">계산</button>
          <button id="reset" class="ghost">초기화</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <canvas id="plot"></canvas>
      </div>

      <div class="info">
        <div class="pill" id="prob">P = -</div>
        <div class="small">선택: <span id="selRange">-</span></div>
      </div>

      <footer>클릭 동작: 첫 클릭 → Zmin 설정, 두 번째 클릭 → Zmax 설정. 다시 클릭하면 재설정됩니다.</footer>
    </div>
  </div>

<script>
function normalPDF(x){return Math.exp(-0.5*x*x)/Math.sqrt(2*Math.PI);} 
function erf(x){const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911;const sign=x<0?-1:1;x=Math.abs(x);const t=1/(1+p*x);const y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);return sign*y;}
function normalCDF(x){return 0.5*(1+erf(x/Math.sqrt(2)));}
function simpson(f,a,b,n){if(n%2===1)n++;const h=(b-a)/n;let s=f(a)+f(b);for(let i=1;i<n;i++){const x=a+i*h;s+=f(x)*(i%2===0?2:4);}return s*h/3;}

const canvas=document.getElementById('plot');const ctx=canvas.getContext('2d');
function resize(){canvas.width=canvas.clientWidth*devicePixelRatio;canvas.height=canvas.clientHeight*devicePixelRatio;ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);draw();}
window.addEventListener('resize',resize);

let zMin=parseFloat(document.getElementById('zMin').value);
let zMax=parseFloat(document.getElementById('zMax').value);
let clicks=[];let samples=[];const domain=4;
function prepareSamples(){samples=[];const step=0.01;for(let x=-domain;x<=domain;x+=step){samples.push({x:x,y:normalPDF(x)});}}
function xToPx(x){const W=canvas.clientWidth;return((x+domain)/(2*domain))*W;}
function yToPx(y){const H=canvas.clientHeight;const padding=36;const maxY=normalPDF(0);return H-padding-(y/maxY)*(H-padding*2);}

function draw(){const W=canvas.clientWidth;const H=canvas.clientHeight;ctx.clearRect(0,0,W,H);ctx.fillStyle='#fff';ctx.fillRect(0,0,W,H);ctx.strokeStyle='rgba(2,6,23,0.04)';ctx.lineWidth=1;for(let i=0;i<6;i++){const yy=H*(i/6);ctx.beginPath();ctx.moveTo(0,yy);ctx.lineTo(W,yy);ctx.stroke();}ctx.strokeStyle='rgba(2,6,23,0.08)';ctx.beginPath();ctx.moveTo(0,H-30);ctx.lineTo(W,H-30);ctx.stroke();ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle='#2563eb';for(let i=0;i<samples.length;i++){const p=samples[i];const px=xToPx(p.x);const py=yToPx(p.y);if(i===0)ctx.moveTo(px,py);else ctx.lineTo(px,py);}ctx.stroke();if(clicks.length==2){const a=Math.min(clicks[0],clicks[1]);const b=Math.max(clicks[0],clicks[1]);ctx.beginPath();ctx.moveTo(xToPx(a),H-30);for(let x=a;x<=b+1e-9;x+=0.01){const y=normalPDF(x);ctx.lineTo(xToPx(x),yToPx(y));}ctx.lineTo(xToPx(b),H-30);ctx.closePath();ctx.fillStyle='rgba(37,99,235,0.18)';ctx.fill();ctx.beginPath();for(let x=a;x<=b+1e-9;x+=0.01){const y=normalPDF(x);if(x===a)ctx.moveTo(xToPx(x),yToPx(y));else ctx.lineTo(xToPx(x),yToPx(y));}ctx.strokeStyle='#1e40af';ctx.lineWidth=1.5;ctx.stroke();}ctx.fillStyle='#475569';ctx.font='12px sans-serif';for(let t=-domain;t<=domain;t++){const px=xToPx(t);ctx.beginPath();ctx.moveTo(px,H-34);ctx.lineTo(px,H-26);ctx.strokeStyle='rgba(2,6,23,0.06)';ctx.stroke();ctx.fillText(t.toFixed(0),px-8,H-6);}for(let i=0;i<clicks.length;i++){const z=clicks[i];const px=xToPx(z);const py=yToPx(normalPDF(z));ctx.beginPath();ctx.fillStyle=i===0?'#0ea5b7':'#ef4444';ctx.arc(px,py,5,0,Math.PI*2);ctx.fill();}}

canvas.addEventListener('click',(e)=>{const rect=canvas.getBoundingClientRect();const cx=(e.clientX-rect.left)/rect.width;const z=-domain+cx*(2*domain);if(clicks.length<2){clicks.push(Number(z.toFixed(3)));}else{clicks=[Number(z.toFixed(3))];}if(clicks.length===1){document.getElementById('zMin').value=clicks[0];document.getElementById('zMax').value=clicks[0];}if(clicks.length===2){const a=Math.min(clicks[0],clicks[1]);const b=Math.max(clicks[0],clicks[1]);document.getElementById('zMin').value=a;document.getElementById('zMax').value=b;}draw();});

function computeAndDisplay(){zMin=parseFloat(document.getElementById('zMin').value);zMax=parseFloat(document.getElementById('zMax').value);if(zMax<zMin){const t=zMin;zMin=zMax;zMax=t;}const approx=simpson(normalPDF,zMin,zMax,1000);document.getElementById('prob').textContent=`P(${zMin} < Z < ${zMax}) ≈ ${approx.toFixed(6)}`;document.getElementById('selRange').textContent=`${zMin.toFixed(3)} ~ ${zMax.toFixed(3)}`;draw();}

document.getElementById('compute').addEventListener('click',()=>{clicks=[parseFloat(document.getElementById('zMin').value),parseFloat(document.getElementById('zMax').value)];computeAndDisplay();});
document.getElementById('reset').addEventListener('click',()=>{clicks=[];document.getElementById('zMin').value='-1';document.getElementById('zMax').value='1';document.getElementById('prob').textContent='P = -';document.getElementById('selRange').textContent='-';draw();});

prepareSamples();resize();
</script>
</body>
</html>
